# 交易策略优化思路 - HKU Web3 Quant Hackathon

## 🎯 优化目标

根据比赛评估标准，优化策略以最大化：
1. **Portfolio Return**（投资组合回报）- 1st Award
2. **Risk-adjusted Return**（风险调整后回报）- 2nd Award
   - Sortino Ratio (权重 0.4)
   - Sharpe Ratio (权重 0.3)
   - Calmar Ratio (权重 0.3)

## 💡 核心优化思路

### 1. 平衡原则（不过于激进，也不过于保守）

**问题**：原策略过于保守（85%信心才开仓），可能错过机会

**解决方案**：
- 降低信心度阈值到 **70-75%**
- 根据信心度调整仓位大小
- 保持严格的风险控制

**具体实施**：
- 70-75% 信心：较小仓位（1-1.5% 风险）
- 75-85% 信心：正常仓位（1.5-2% 风险）
- 85%+ 信心：较大仓位（2% 风险）

### 2. 多指标优化（从单一Sharpe到三指标综合）

**问题**：原策略只关注 Sharpe Ratio，没有考虑 Sortino 和 Calmar

**解决方案**：
- **Sortino Ratio (权重0.4)**：控制下行风险
  - 快速止损，避免大亏损
  - 盈利时让利润奔跑
- **Sharpe Ratio (权重0.3)**：控制总波动
  - 避免频繁交易
  - 稳定的仓位管理
- **Calmar Ratio (权重0.3)**：控制最大回撤
  - 严格的回撤控制
  - 盈利保护机制

**具体实施**：
- 添加 Sortino、Calmar 检查
- 综合评估三个指标
- 优先考虑 Sortino（权重0.4）

### 3. 手续费优化（考虑0.2%总成本）

**问题**：原策略没有充分考虑手续费的影响

**解决方案**：
- 所有盈亏比计算都考虑 0.2% 手续费（买入+卖出）
- 最小盈亏比：2.5:1（考虑手续费后）
- 最小盈利目标：0.5%（覆盖手续费后）

**具体实施**：
- 止损：1-1.5%（考虑手续费后）
- 止盈：≥2.5%（考虑手续费后，确保净盈利）
- 盈利保护：盈利 >2.5% 将止损提升至成本（考虑手续费）

### 4. 时间优化（适应2周比赛）

**问题**：原策略冷却期过长，可能错过机会

**解决方案**：
- 缩短冷却期（9分钟 → 5-6分钟）
- 缩短连亏暂停时间（45分钟 → 30分钟）
- 平衡交易频率和风险控制

**具体实施**：
- 距上次开仓 ≥5-6 分钟（从9分钟优化）
- 若有持仓则已持有 ≥20 分钟（从30分钟优化）
- 连亏 2 笔→停 30 分钟（从45分钟优化）

### 5. 回撤控制优化（提升Calmar Ratio）

**问题**：原策略回撤控制不够严格

**解决方案**：
- 更严格的回撤控制（单日亏损 >3% 停止交易）
- 最大回撤监控
- 盈利保护机制

**具体实施**：
- 单日亏损 >3%→停止交易（从5%优化）
- 当前回撤 >3%→减少仓位
- 当前回撤 >5%→停止交易
- 盈利后及时止盈，保护利润

## 📊 优化前后对比

| 方面 | 优化前 | 优化后 | 理由 |
|------|--------|--------|------|
| **信心度阈值** | 85% | 70-75% | 平衡风险和收益，不过于保守 |
| **冷却期** | 9分钟 | 5-6分钟 | 适应2周比赛，合理交易频率 |
| **连亏暂停** | 45分钟 | 30分钟 | 适应2周比赛，但仍保护资金 |
| **单日亏损限制** | 5% | 3% | 更严格的控制回撤，提升Calmar |
| **止损** | 1-2% | 1-1.5% | 考虑手续费后 |
| **止盈** | ≥2% | ≥2.5% | 考虑手续费后，确保净盈利 |
| **盈亏比** | 2:1 | 2.5:1 | 考虑手续费后 |
| **盈利保护** | >3% | >2.5% | 考虑手续费后，确保不亏损 |
| **指标关注** | 只关注Sharpe | Sortino+Sharpe+Calmar | 多指标优化 |
| **仓位管理** | 固定 | 根据信心度调整 | 平衡风险和收益 |

## 🎯 关键优化点

### 1. 信心度阈值调整

**优化前**：
- 要求 85% 信心才开仓
- 过于保守，可能错过机会

**优化后**：
- 70-75% 信心即可开仓
- 根据信心度调整仓位
- 保持风险控制

### 2. 多指标优化

**优化前**：
- 只关注 Sharpe Ratio

**优化后**：
- Sortino Ratio (权重0.4) - 控制下行风险
- Sharpe Ratio (权重0.3) - 控制总波动
- Calmar Ratio (权重0.3) - 控制最大回撤

### 3. 手续费优化

**优化前**：
- 没有充分考虑手续费

**优化后**：
- 所有决策考虑 0.2% 手续费
- 最小盈亏比 2.5:1
- 最小盈利目标 0.5%

### 4. 时间优化

**优化前**：
- 冷却期 9 分钟
- 连亏暂停 45 分钟

**优化后**：
- 冷却期 5-6 分钟
- 连亏暂停 30 分钟
- 适应2周比赛

### 5. 回撤控制

**优化前**：
- 单日亏损 >5% 停止交易

**优化后**：
- 单日亏损 >3% 停止交易
- 最大回撤监控
- 盈利保护机制

## 📈 预期效果

### 优化前的问题
1. ❌ 过于保守，可能错过机会
2. ❌ 只关注 Sharpe，没有考虑 Sortino 和 Calmar
3. ❌ 冷却期过长，交易频率可能过低
4. ❌ 手续费考虑不足
5. ❌ 回撤控制不够严格

### 优化后的改进
1. ✅ 平衡风险和收益，不过于激进也不过于保守
2. ✅ 综合考虑三个指标，优化风险调整后回报
3. ✅ 合理交易频率，适应2周比赛
4. ✅ 充分考虑手续费，确保净盈利
5. ✅ 严格回撤控制，提升 Calmar Ratio

## 🎯 策略核心

### 1. 平衡原则
- **不过于激进**：保持严格的风险控制
- **不过于保守**：在合理信心下（70%+）积极捕捉机会
- **平衡策略**：在风险可控的前提下，最大化收益

### 2. 多指标优化
- **Sortino (0.4)**：控制下行风险，快速止损，让利润奔跑
- **Sharpe (0.3)**：控制总波动，避免频繁交易
- **Calmar (0.3)**：控制最大回撤，严格回撤控制

### 3. 手续费优化
- **所有决策考虑 0.2% 手续费**
- **最小盈亏比 2.5:1**
- **最小盈利目标 0.5%**

### 4. 风险控制
- **单笔风险 ≤ 2%**
- **单日回撤 >3% 减少仓位**
- **单日回撤 >5% 停止交易**
- **每笔交易都有止损**

## 🔄 实施步骤

### 阶段1：Prompt 优化 ✅
- [x] 修改信心度阈值（85% → 70-75%）
- [x] 调整冷却期（9分钟 → 5-6分钟）
- [x] 优化止损止盈策略（考虑手续费）
- [x] 添加多指标优化指导
- [x] 添加回撤控制机制

### 阶段2：策略逻辑优化（待实施）
- [ ] 添加 Sortino Ratio 计算和监控
- [ ] 添加 Calmar Ratio 计算和监控
- [ ] 优化仓位管理（根据信心度调整）
- [ ] 优化手续费考虑

### 阶段3：测试和调整（待实施）
- [ ] 回测优化后的策略
- [ ] 调整参数（信心度、冷却期等）
- [ ] 优化多指标平衡

## 📝 总结

优化后的策略：
1. ✅ **平衡风险和收益**：不过于激进，也不过于保守
2. ✅ **多指标优化**：综合考虑 Sortino、Sharpe、Calmar
3. ✅ **手续费优化**：所有决策考虑 0.2% 手续费
4. ✅ **时间优化**：适应2周比赛，合理交易频率
5. ✅ **风险控制**：严格但不过度的风险控制

这样的策略可以在保持风险控制的同时，最大化风险调整后回报，从而在比赛中获得更好的成绩。

## 🚀 下一步

1. **测试优化后的策略**：使用测试模式运行，验证优化效果
2. **监控关键指标**：跟踪 Portfolio Return、Sortino、Sharpe、Calmar
3. **动态调整**：根据市场情况和表现调整参数
4. **记录和分析**：记录所有交易决策，分析效果

