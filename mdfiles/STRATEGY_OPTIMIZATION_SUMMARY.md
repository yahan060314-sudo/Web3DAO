# 交易策略优化总结 - HKU Web3 Quant Hackathon

## 🎯 优化思路

根据比赛要求，我对交易策略进行了全面优化，核心思路是：**平衡风险和收益，不过于激进，也不过于保守**。

### 比赛评估标准
- **1st Award**: Portfolio Return（投资组合回报）
- **2nd Award**: Risk-adjusted Return（风险调整后回报）
  - **0.4× Sortino Ratio** - 下行风险（只考虑亏损波动）
  - **0.3× Sharpe Ratio** - 总风险（所有波动）
  - **0.3× Calmar Ratio** - 最大回撤风险

### 关键约束
- ✅ 只能现货交易，无杠杆、无做空
- ✅ 手续费 0.1%（每笔交易，买入+卖出=0.2%）
- ✅ 不能高频交易（限频保护）
- ✅ 比赛持续 2 周

## 📊 主要优化内容

### 1. 多指标优化（从单一Sharpe到三指标综合）

**优化前**：
- 只关注 Sharpe Ratio
- 没有考虑 Sortino 和 Calmar

**优化后**：
- **Sortino Ratio (权重0.4)**：重点控制下行风险
  - 快速止损，避免大亏损
  - 盈利时让利润奔跑
- **Sharpe Ratio (权重0.3)**：控制总波动
  - 避免频繁交易
  - 稳定的仓位管理
- **Calmar Ratio (权重0.3)**：控制最大回撤
  - 严格的回撤控制
  - 盈利保护机制

### 2. 信心度阈值调整（从85%降低到70-75%）

**优化前**：
- 要求 85% 信心才开仓
- 过于保守，可能错过机会

**优化后**：
- **70-75% 信心**：可以开仓，使用较小仓位（1-1.5% 风险）
- **75-85% 信心**：正常开仓，使用正常仓位（1.5-2% 风险）
- **85%+ 信心**：较大仓位，但仍不超过 2% 风险限制
- **<70% 信心**：等待更好机会

**平衡策略**：
- 不过于保守：70%+ 信心即可开仓
- 不过于激进：保持严格的风险控制
- 根据信心度调整仓位大小

### 3. 冷却期优化（从9分钟降低到5-6分钟）

**优化前**：
- 距上次开仓 ≥9 分钟
- 若有持仓则已持有 ≥30 分钟

**优化后**：
- 距上次开仓 ≥5-6 分钟（适应2周比赛）
- 若有持仓则已持有 ≥20 分钟
- 刚止损后 ≥4 分钟（从6分钟优化）
- 刚止盈后同向再入 ≥2 分钟（从3分钟优化）

**理由**：
- 2周比赛时间有限，需要合理平衡交易频率和风险
- 缩短冷却期可以捕捉更多机会
- 但仍保持风险控制

### 4. 连亏暂停优化（更严格的控制回撤）

**优化前**：
- 连亏 2 笔→停 45 分钟
- 单日亏损 >5%→停止交易

**优化后**：
- 连亏 2 笔→停 30 分钟（适应2周比赛）
- 连亏 3 笔→停 18 小时（从24小时优化）
- 连亏 4 笔→停 48 小时（从72小时优化）
- **单日亏损 >3%→停止交易**（从5%优化，更严格的控制回撤）

**理由**：
- 更严格的控制回撤，提升 Calmar Ratio
- 适应2周比赛时间
- 保护资金，避免大亏损

### 5. 止损止盈优化（考虑手续费）

**优化前**：
- 止损：1-2%
- 止盈：≥2%（盈亏比 ≥ 2:1）

**优化后**：
- **止损：1-1.5%**（考虑手续费后，实际亏损控制在1-1.5%）
- **止盈：≥2.5%**（考虑手续费后，确保净盈利≥2.5%，盈亏比≥2.5:1）
- **最小盈利目标：0.5%**（覆盖手续费后）

**理由**：
- 手续费 0.2%（买入+卖出）影响盈亏比
- 确保净盈利，不被手续费吞噬
- 优化盈亏比，提升收益

### 6. 盈利保护机制优化（提升Calmar Ratio）

**优化前**：
- 盈利 >3% 将止损提升至成本
- 盈利 >10% 将止损提升至 +5%

**优化后**：
- **盈利 >2.5%→将止损提升至成本**（考虑手续费，确保不亏损）
- **盈利 >5%→将止损提升至成本+1%**（保护利润）
- **盈利 >10%→将止损提升至成本+3%**（保护更多利润）
- 其后每 +5% 上移止损 2%（保护利润，减少回撤）

**理由**：
- 更早保护利润，减少回撤
- 提升 Calmar Ratio
- 考虑手续费，确保不亏损

### 7. 分批止盈优化（减少回撤风险）

**优化前**：
- 达阶段目标（5%-10%）先平 50%/70%

**优化后**：
- **达阶段目标（5%-8%）先平 50%**（锁定部分收益，减少回撤风险）
- 余仓以追踪止损方式持有（让利润奔跑，但保护已有利润）

**理由**：
- 更早锁定收益，减少回撤风险
- 提升 Calmar Ratio
- 平衡收益和风险

### 8. 最大回撤控制（新增）

**新增内容**：
- **当前回撤 >3%→减少仓位，仅做信心 >85% 的交易**
- **当前回撤 >5%→停止交易，等待市场恢复**
- **盈利后及时止盈，保护利润，减少回撤**

**理由**：
- 严格控制回撤，提升 Calmar Ratio
- 保护资金，避免大亏损
- 动态调整风险水平

### 9. 手续费考虑（新增）

**新增内容**：
- **所有盈亏比计算都考虑 0.2% 手续费**（买入+卖出）
- **最小盈亏比：2.5:1**（考虑手续费后）
- **最小盈利目标：0.5%**（覆盖手续费后）

**理由**：
- 手续费影响实际收益
- 确保净盈利，不被手续费吞噬
- 优化交易决策

## 🔄 优化前后对比

### 信心度阈值
- **优化前**：85% 信心才开仓
- **优化后**：70%+ 信心即可开仓，根据信心度调整仓位

### 冷却期
- **优化前**：9 分钟
- **优化后**：5-6 分钟

### 连亏暂停
- **优化前**：单日亏损 >5% 停止交易
- **优化后**：单日亏损 >3% 停止交易

### 止损止盈
- **优化前**：止损 1-2%，止盈 ≥2%（盈亏比 2:1）
- **优化后**：止损 1-1.5%，止盈 ≥2.5%（盈亏比 2.5:1，考虑手续费）

### 盈利保护
- **优化前**：盈利 >3% 将止损提升至成本
- **优化后**：盈利 >2.5% 将止损提升至成本（考虑手续费）

### 指标关注
- **优化前**：只关注 Sharpe Ratio
- **优化后**：综合考虑 Sortino (0.4) + Sharpe (0.3) + Calmar (0.3)

## 📈 预期效果

### 优化前的问题
1. ❌ 过于保守，可能错过机会
2. ❌ 只关注 Sharpe，没有考虑 Sortino 和 Calmar
3. ❌ 冷却期过长，交易频率可能过低
4. ❌ 手续费考虑不足
5. ❌ 回撤控制不够严格

### 优化后的改进
1. ✅ 平衡风险和收益，不过于激进也不过于保守
2. ✅ 综合考虑三个指标，优化风险调整后回报
3. ✅ 合理交易频率，适应2周比赛
4. ✅ 充分考虑手续费，确保净盈利
5. ✅ 严格回撤控制，提升 Calmar Ratio

## 🎯 策略核心

### 1. 平衡原则
- **不过于激进**：保持严格的风险控制
- **不过于保守**：在合理信心下（70%+）积极捕捉机会
- **平衡策略**：在风险可控的前提下，最大化收益

### 2. 多指标优化
- **Sortino (0.4)**：控制下行风险，快速止损，让利润奔跑
- **Sharpe (0.3)**：控制总波动，避免频繁交易
- **Calmar (0.3)**：控制最大回撤，严格回撤控制

### 3. 手续费优化
- **所有决策考虑 0.2% 手续费**
- **最小盈亏比 2.5:1**
- **最小盈利目标 0.5%**

### 4. 风险控制
- **单笔风险 ≤ 2%**
- **单日回撤 >3% 减少仓位**
- **单日回撤 >5% 停止交易**
- **每笔交易都有止损**

## 📋 实施建议

### 1. 测试优化后的策略
- 使用测试模式运行，验证优化效果
- 检查决策频率和风险控制
- 评估多指标表现

### 2. 监控关键指标
- Portfolio Return（主要目标）
- Sortino Ratio（权重0.4）
- Sharpe Ratio（权重0.3）
- Calmar Ratio（权重0.3）
- 最大回撤

### 3. 动态调整
- 根据市场情况调整参数
- 根据表现调整信心度阈值
- 根据回撤情况调整风险水平

### 4. 记录和分析
- 记录所有交易决策
- 分析决策效果
- 优化策略参数

## 🎉 总结

优化后的策略：
1. ✅ **平衡风险和收益**：不过于激进，也不过于保守
2. ✅ **多指标优化**：综合考虑 Sortino、Sharpe、Calmar
3. ✅ **手续费优化**：所有决策考虑 0.2% 手续费
4. ✅ **时间优化**：适应2周比赛，合理交易频率
5. ✅ **风险控制**：严格但不过度的风险控制

这样的策略可以在保持风险控制的同时，最大化风险调整后回报，从而在比赛中获得更好的成绩。

## 📚 相关文件

- `prompts/natural_language_prompt.txt` - 优化后的prompt模板
- `STRATEGY_OPTIMIZATION_PLAN.md` - 详细的优化方案
- `api/agents/prompt_manager.py` - Prompt管理器

## 🚀 下一步

1. **测试优化后的策略**：使用测试模式运行，验证优化效果
2. **监控关键指标**：跟踪 Portfolio Return、Sortino、Sharpe、Calmar
3. **动态调整**：根据市场情况和表现调整参数
4. **记录和分析**：记录所有交易决策，分析效果

祝您比赛顺利！🎉

