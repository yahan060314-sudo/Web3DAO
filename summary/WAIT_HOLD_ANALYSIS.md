# Wait/Hold 决策分析

## 🔍 可能原因分析

### 1. ⚠️ **系统提示词过于保守**（最可能的原因）

#### Agent 1（保守型）
```python
risk_level="conservative"
trading_strategy="Focus on capital preservation and risk management. Make conservative trading decisions."
```

**风险指导原则**：
```
"Be very cautious. Only trade when there's high confidence. Preserve capital."
```

#### Agent 2（平衡型）
```python
risk_level="moderate"
trading_strategy="Balance risk and reward. Look for good trading opportunities with moderate risk."
```

**风险指导原则**：
```
"Balance risk and reward. Look for good opportunities but don't take excessive risks."
```

**影响**：两个Agent都被设置为保守或平衡策略，倾向于等待更好的机会。

---

### 2. ⚠️ **"零号原则：疑惑优先"**（关键因素）

在 `prompts/natural_language_prompt.txt` 中有明确的"零号原则"：

```
# 零号原则：疑惑优先（最高优先级）
⚠️ 当你不确定时，默认选择 `wait`。这是最高优先级原则，覆盖所有其他规则：
- 有任何疑虑 → 选 `wait`（不要"勉强开仓"）
- 仅当【信心 ≥85 且无任何犹豫】→ 才能开仓
- 不确定是否违反某条款 = 视为违反 → `wait`
- 宁可错过机会，不做模糊决策
```

**影响**：这个原则要求模型必须有≥85的信心度才能开仓，否则默认wait。如果模型对市场判断不够确定，就会选择wait。

---

### 3. ⚠️ **LLM参数设置保守**

```python
llm_out = self.llm.chat(messages, temperature=0.3, max_tokens=512)
```

- **temperature=0.3**：较低的温度值，输出更保守、更确定
- **max_tokens=512**：可能限制了详细分析的空间

**影响**：低温度值会让模型更倾向于保守的选择。

---

### 4. ⚠️ **市场数据可能不够充分**

#### 当前提供的数据
- 当前价格（ticker）
- 账户余额（balance）
- 24小时涨跌幅、成交量

#### 可能缺少的数据
- ❌ 历史价格数据（无法判断趋势）
- ❌ 技术指标（MACD、RSI、EMA等）
- ❌ 持仓信息（不知道当前是否有持仓）
- ❌ 历史交易记录（无法学习）
- ❌ 多周期数据（只有当前快照）

**影响**：如果模型无法看到足够的技术指标和历史数据，很难做出有信心的交易决策，只能选择wait。

---

### 5. ⚠️ **思考标准过于严格**

从 `natural_language_prompt.txt` 看，有严格的思考标准：

```
# 思考标准（严格顺序，任何一步失败 → 直接 `wait`）
0) 疑惑检查：若不确定/矛盾/模糊 → `wait`
1) 冷却期检查：距上次开仓 ≥9 分钟；若有持仓则已持有 ≥30 分钟...
2) 连亏暂停：连亏 2 笔→停 45 分钟...
3) 夏普检查：Sharpe < -0.5→停 18 分钟...
4) 持仓评估（若有持仓）：趋势反转→`close_long`...
5) BTC 状态确认：BTC 为方向锚，15m/1h/4h MACD 必须同向...
```

**问题**：
- 系统可能无法提供这些检查所需的数据（如冷却期、连亏记录、夏普比率、多周期MACD等）
- 如果任何一步检查失败，就会直接 `wait`
- 由于缺少这些数据，模型可能无法通过检查，只能选择wait

---

### 6. ⚠️ **缺少历史上下文**

Agent在生成决策时：
- ✅ 能看到当前市场数据
- ✅ 能看到最近5条对话历史
- ❌ **看不到之前的决策记录**
- ❌ **看不到订单执行结果**
- ❌ **看不到持仓状态**

**影响**：模型无法知道：
- 之前是否已经开仓
- 之前的决策是否成功
- 当前是否有持仓需要管理
- 市场趋势如何变化

这会导致模型倾向于保守，选择wait。

---

## 📊 综合判断

### 最可能的原因（按概率排序）

1. **"零号原则"过于严格**（90%概率）
   - 要求信心度≥85才能开仓
   - 任何不确定都默认wait
   - 这是设计上的保守策略

2. **市场数据不够充分**（80%概率）
   - 缺少技术指标（MACD、RSI、EMA等）
   - 缺少历史数据（无法判断趋势）
   - 缺少持仓信息（不知道当前状态）

3. **系统提示词保守**（70%概率）
   - Agent 1设置为conservative
   - 强调"capital preservation"
   - 要求"high confidence"

4. **缺少历史决策记录**（60%概率）
   - 模型看不到之前的决策
   - 无法学习哪些决策有效
   - 无法判断市场趋势

5. **LLM参数保守**（40%概率）
   - temperature=0.3较低
   - 但这不是主要原因

---

## 🔧 可能的解决方案（仅分析，不实施）

### 方案1：调整系统提示词
- 降低"零号原则"的严格程度
- 将信心度要求从≥85降低到≥70
- 或者移除"疑惑优先"原则

### 方案2：提供更多市场数据
- 添加技术指标计算（MACD、RSI、EMA等）
- 提供历史价格数据（用于趋势分析）
- 提供持仓信息

### 方案3：调整LLM参数
- 提高temperature到0.5-0.7（增加创造性）
- 增加max_tokens（允许更详细的分析）

### 方案4：提供历史决策上下文
- 让Agent能看到最近的决策记录
- 让Agent能看到订单执行结果
- 让Agent能看到持仓状态

### 方案5：调整风险等级
- 将Agent 1从conservative改为moderate
- 或者创建一个aggressive的Agent

---

## 🎯 结论

**最可能的原因**：
1. **"零号原则"设计过于保守** - 要求信心度≥85，任何不确定都wait
2. **市场数据不够充分** - 缺少技术指标和历史数据，模型无法做出有信心的判断
3. **系统提示词保守** - Agent被设置为保守策略

**这不是运行错误，而是设计上的保守策略**。模型按照提示词的要求，在不确定时选择wait，这是符合预期的行为。

如果想要更多交易决策，需要：
- 调整提示词，降低信心度要求
- 提供更多市场数据（技术指标、历史数据）
- 或者接受这种保守策略（可能更安全）

